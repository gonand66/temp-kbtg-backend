# KBTG Backend API

Backend API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (User Management) ‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏° (Points Transfer) ‡∏ó‡∏µ‡πà‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏î‡πâ‡∏ß‡∏¢ Go + Fiber Framework ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ SQLite ‡πÄ‡∏õ‡πá‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

## üöÄ Features

- ‚úÖ RESTful API ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (CRUD)
- ‚úÖ **Points Transfer System** - ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏ö‡∏ö‡∏≠‡∏∞‡∏ï‡∏≠‡∏°‡∏°‡∏¥‡∏Å
- ‚úÖ **Idempotency Support** - ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ã‡πâ‡∏≥‡∏î‡πâ‡∏ß‡∏¢ Idempotency Key
- ‚úÖ **Point Ledger** - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á (Audit Trail)
- ‚úÖ **Transaction Safety** - ‡πÉ‡∏ä‡πâ Database Transaction ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
- ‚úÖ SQLite Database (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á Database Server)
- ‚úÖ Auto-generate Membership ID (LBK######)
- ‚úÖ Middleware: CORS, Logger
- ‚úÖ Sample Data ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
- ‚úÖ OpenAPI 3.1 Compliant (‡∏ï‡∏≤‡∏° transfer.yml spec)

## üìã Prerequisites

- Go 1.17 ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤
- GCC compiler (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö SQLite driver)

## üõ†Ô∏è Installation

1. Clone ‡∏´‡∏£‡∏∑‡∏≠ download project ‡∏ô‡∏µ‡πâ

2. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies:

```bash
go mod download
```

3. ‡∏£‡∏±‡∏ô application:

```bash
go run main.go
```

Server ‡∏à‡∏∞‡∏£‡∏±‡∏ô‡∏ó‡∏µ‡πà `http://localhost:3000`

## üìÅ Project Structure

```
temp-kbtg-backend/
‚îú‚îÄ‚îÄ main.go                    # Entry point & Routes
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ user.go               # User model & request structs
‚îÇ   ‚îî‚îÄ‚îÄ transfer.go           # Transfer & PointLedger models
‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îî‚îÄ‚îÄ db.go                 # SQLite connection & initialization
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îú‚îÄ‚îÄ user_handler.go       # User CRUD handlers
‚îÇ   ‚îî‚îÄ‚îÄ transfer_handler.go   # Transfer handlers
‚îú‚îÄ‚îÄ users.db                  # SQLite database (auto-created)
‚îú‚îÄ‚îÄ go.mod                    # Go module dependencies
‚îî‚îÄ‚îÄ README.md                 # ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
```

## üìä User Model

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö:

| Field              | Type     | Description                                  |
| ------------------ | -------- | -------------------------------------------- |
| `id`               | Integer  | ID ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Primary Key)                   |
| `membership_id`    | String   | ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÄ‡∏ä‡πà‡∏ô LBK001234) - Auto-generated |
| `first_name`       | String   | ‡∏ä‡∏∑‡πà‡∏≠                                         |
| `last_name`        | String   | ‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•                                      |
| `phone_number`     | String   | ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå                                |
| `email`            | String   | ‡∏≠‡∏µ‡πÄ‡∏°‡∏• (Unique)                               |
| `membership_level` | String   | ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Gold/Silver/Bronze)             |
| `points`           | Integer  | ‡πÅ‡∏ï‡πâ‡∏°‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠                                  |
| `joined_date`      | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å                            |
| `created_at`       | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•                            |
| `updated_at`       | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î                      |

## üîå API Endpoints

### 1. Get All Users

‡∏î‡∏∂‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î

```http
GET /users
```

**Response Example:**

```json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "membership_id": "LBK001234",
      "first_name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
      "last_name": "‡πÉ‡∏à‡∏î‡∏µ",
      "phone_number": "081-234-5678",
      "email": "somchai@example.com",
      "membership_level": "Gold",
      "points": 15420,
      "joined_date": "2023-06-15T00:00:00Z",
      "created_at": "2025-10-17T13:46:28Z",
      "updated_at": "2025-10-17T13:46:28Z"
    }
  ],
  "total": 1
}
```

### 2. Get User by ID

‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•

```http
GET /users/{id}
```

**Example:**

```bash
curl http://localhost:3000/users/1
```

**Response Example:**

```json
{
  "success": true,
  "data": {
    "id": 1,
    "membership_id": "LBK001234",
    "first_name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
    "last_name": "‡πÉ‡∏à‡∏î‡∏µ",
    "phone_number": "081-234-5678",
    "email": "somchai@example.com",
    "membership_level": "Gold",
    "points": 15420,
    "joined_date": "2023-06-15T00:00:00Z",
    "created_at": "2025-10-17T13:46:28Z",
    "updated_at": "2025-10-17T13:46:28Z"
  }
}
```

### 3. Create User

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà

```http
POST /users
Content-Type: application/json
```

**Request Body:**

```json
{
  "first_name": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
  "last_name": "‡∏£‡∏∞‡∏ö‡∏ö",
  "phone_number": "099-999-9999",
  "email": "test@example.com",
  "membership_level": "Gold"
}
```

**Required Fields:**

- `first_name` (required)
- `last_name` (required)
- `phone_number` (required)
- `email` (required)
- `membership_level` (optional, default: "Bronze")

**Example:**

```bash
curl -X POST http://localhost:3000/users \
  -H "Content-Type: application/json" \
  -d '{
    "first_name": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
    "last_name": "‡∏£‡∏∞‡∏ö‡∏ö",
    "phone_number": "099-999-9999",
    "email": "test@example.com",
    "membership_level": "Gold"
  }'
```

**Response Example:**

```json
{
  "success": true,
  "message": "User created successfully",
  "data": {
    "id": 4,
    "membership_id": "LBK000004",
    "first_name": "‡∏ó‡∏î‡∏™‡∏≠‡∏ö",
    "last_name": "‡∏£‡∏∞‡∏ö‡∏ö",
    "phone_number": "099-999-9999",
    "email": "test@example.com",
    "membership_level": "Gold",
    "points": 0,
    "joined_date": "2025-10-17T13:50:00Z",
    "created_at": "2025-10-17T13:50:00Z",
    "updated_at": "2025-10-17T13:50:00Z"
  }
}
```

### 4. Update User

‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```http
PUT /users/{id}
Content-Type: application/json
```

**Request Body (‡∏™‡πà‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ field ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç):**

```json
{
  "first_name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
  "last_name": "‡πÉ‡∏à‡∏î‡∏µ",
  "phone_number": "081-234-5678",
  "email": "somchai@example.com",
  "membership_level": "Platinum",
  "points": 20000
}
```

**Example:**

```bash
curl -X PUT http://localhost:3000/users/1 \
  -H "Content-Type: application/json" \
  -d '{
    "points": 20000,
    "membership_level": "Platinum"
  }'
```

**Response Example:**

```json
{
  "success": true,
  "message": "User updated successfully",
  "data": {
    "id": 1,
    "membership_id": "LBK001234",
    "first_name": "‡∏™‡∏°‡∏ä‡∏≤‡∏¢",
    "last_name": "‡πÉ‡∏à‡∏î‡∏µ",
    "phone_number": "081-234-5678",
    "email": "somchai@example.com",
    "membership_level": "Platinum",
    "points": 20000,
    "joined_date": "2023-06-15T00:00:00Z",
    "created_at": "2025-10-17T13:46:28Z",
    "updated_at": "2025-10-17T13:52:00Z"
  }
}
```

### 5. Delete User

‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```http
DELETE /users/{id}
```

**Example:**

```bash
curl -X DELETE http://localhost:3000/users/1
```

**Response Example:**

```json
{
  "success": true,
  "message": "User deleted successfully"
}
```

## üéÅ Sample Data

‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ô application ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 3 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

1. **‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ** - Gold Member (15,420 ‡πÅ‡∏ï‡πâ‡∏°)
2. **‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏£‡∏±‡∏Å‡∏î‡∏µ** - Silver Member (8,500 ‡πÅ‡∏ï‡πâ‡∏°)
3. **‡∏™‡∏°‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏°‡∏µ‡∏™‡∏∏‡∏Ç** - Bronze Member (2,100 ‡πÅ‡∏ï‡πâ‡∏°)

## üîß Technologies

- **Go** - Programming Language
- **Fiber v2** - Web Framework (Express-like for Go)
- **SQLite** - Embedded Database
- **go-sqlite3** - SQLite Driver for Go

## üìù Response Format

‡∏ó‡∏∏‡∏Å API response ‡∏à‡∏∞‡∏°‡∏µ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:

**Success Response:**

```json
{
  "success": true,
  "message": "‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)",
  "data": { ... },
  "total": 0
}
```

**Error Response:**

```json
{
  "success": false,
  "message": "Error message",
  "error": "Detailed error (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"
}
```

## üö® Error Codes

| Status Code | Description                         |
| ----------- | ----------------------------------- |
| 200         | Success                             |
| 201         | Created                             |
| 400         | Bad Request (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)      |
| 404         | Not Found (‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)             |
| 409         | Conflict (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ã‡πâ‡∏≥ ‡πÄ‡∏ä‡πà‡∏ô Email ‡∏ã‡πâ‡∏≥) |
| 500         | Internal Server Error               |

## üß™ Testing

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ curl:

```bash
# ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
curl http://localhost:3000/users

# ‡∏î‡∏π‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
curl http://localhost:3000/users/1

# ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÉ‡∏´‡∏°‡πà
curl -X POST http://localhost:3000/users \
  -H "Content-Type: application/json" \
  -d '{"first_name":"‡∏ó‡∏î‡∏™‡∏≠‡∏ö","last_name":"‡∏£‡∏∞‡∏ö‡∏ö","phone_number":"099-999-9999","email":"test@example.com"}'

# ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
curl -X PUT http://localhost:3000/users/1 \
  -H "Content-Type: application/json" \
  -d '{"points":25000}'

# ‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
curl -X DELETE http://localhost:3000/users/1
```

### ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Postman:

1. Import collection ‡∏à‡∏≤‡∏Å API endpoints ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
2. Set base URL: `http://localhost:3000`
3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞ endpoint ‡∏ï‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£

## üí° Tips

- **Database Location**: ‡πÑ‡∏ü‡∏•‡πå `users.db` ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏ô root directory ‡∏Ç‡∏≠‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ
- **Membership ID Format**: LBK + 6 ‡∏´‡∏•‡∏±‡∏Å (‡πÄ‡∏ä‡πà‡∏ô LBK001234)
- **Default Membership Level**: Bronze (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á)
- **CORS**: Enable ‡∏ó‡∏∏‡∏Å origins (`*`) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö development
- **Idempotency Key**: ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ auto-generate UUID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°
- **Transaction Safety**: ‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏ä‡πâ Database Transaction ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

---

## üîÑ Transfer API (Points Transfer System)

### Database Schema

#### Transfers Table

‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏° ‡∏û‡∏£‡πâ‡∏≠‡∏° idempotency key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤

| Field             | Type     | Description                                                    |
| ----------------- | -------- | -------------------------------------------------------------- |
| `id`              | Integer  | ID ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö (Auto-increment)                                  |
| `from_user_id`    | Integer  | ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô                                                   |
| `to_user_id`      | Integer  | ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö                                                   |
| `amount`          | Integer  | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô (> 0)                                          |
| `status`          | String   | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (pending/processing/completed/failed/cancelled/reversed) |
| `note`            | String   | ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (optional)                                            |
| `idempotency_key` | String   | Unique key ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏ã‡πâ‡∏≥                      |
| `created_at`      | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á                                                    |
| `updated_at`      | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î                                             |
| `completed_at`    | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à                                                 |
| `fail_reason`     | String   | ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏ó‡∏µ‡πà‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)                                       |

#### Point Ledger Table

‡∏™‡∏°‡∏∏‡∏î‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏ï‡πâ‡∏° - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏ï‡πâ‡∏° (Append-only)

| Field           | Type     | Description                                          |
| --------------- | -------- | ---------------------------------------------------- |
| `id`            | Integer  | ID ‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö                                         |
| `user_id`       | Integer  | ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ                                         |
| `change`        | Integer  | ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á (+‡∏£‡∏±‡∏ö / -‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å)                 |
| `balance_after` | Integer  | ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£                               |
| `event_type`    | String   | ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (transfer_out/transfer_in/adjust/earn/redeem) |
| `transfer_id`   | Integer  | ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡∏ñ‡∏∂‡∏á transfers.id                              |
| `reference`     | String   | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°                               |
| `metadata`      | String   | JSON metadata                                        |
| `created_at`    | DateTime | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á                                          |

### Transfer API Endpoints

#### 1. Create Transfer (POST /transfers)

‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏° - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞ generate Idempotency-Key ‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

```http
POST /transfers
Content-Type: application/json
```

**Request Body:**

```json
{
  "fromUserId": 1,
  "toUserId": 2,
  "amount": 250,
  "note": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"
}
```

**Response (201 Created):**

```json
{
  "transfer": {
    "idemKey": "5d1f8c7a-2b5b-4b1f-9f2a-8f50b0a8d9f3",
    "transferId": 1,
    "fromUserId": 1,
    "toUserId": 2,
    "amount": 250,
    "status": "completed",
    "note": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô",
    "createdAt": "2025-10-17T14:03:12Z",
    "updatedAt": "2025-10-17T14:03:12Z",
    "completedAt": "2025-10-17T14:03:12Z"
  }
}
```

**Response Headers:**

```
Idempotency-Key: 5d1f8c7a-2b5b-4b1f-9f2a-8f50b0a8d9f3
```

**Example:**

```bash
curl -X POST http://localhost:3000/transfers \
  -H "Content-Type: application/json" \
  -d '{
    "fromUserId": 1,
    "toUserId": 2,
    "amount": 250,
    "note": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô"
  }'
```

**Error Responses:**

- **400 Bad Request**: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á

```json
{
  "error": "VALIDATION_ERROR",
  "message": "amount must be > 0"
}
```

- **404 Not Found**: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ

```json
{
  "error": "NOT_FOUND",
  "message": "Sender user not found"
}
```

- **409 Conflict**: ‡πÅ‡∏ï‡πâ‡∏°‡πÑ‡∏°‡πà‡∏û‡∏≠

```json
{
  "error": "INSUFFICIENT_POINTS",
  "message": "Insufficient points. Available: 100, Required: 250"
}
```

- **422 Unprocessable Entity**: ‡πÇ‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á

```json
{
  "error": "BUSINESS_RULE_VIOLATION",
  "message": "Cannot transfer to yourself"
}
```

#### 2. Get Transfer by ID (GET /transfers/{id})

‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡πÇ‡∏≠‡∏ô - ‡πÉ‡∏ä‡πâ `idemKey` ‡πÄ‡∏õ‡πá‡∏ô id

```http
GET /transfers/{idemKey}
```

**Example:**

```bash
curl http://localhost:3000/transfers/5d1f8c7a-2b5b-4b1f-9f2a-8f50b0a8d9f3
```

**Response (200 OK):**

```json
{
  "transfer": {
    "idemKey": "5d1f8c7a-2b5b-4b1f-9f2a-8f50b0a8d9f3",
    "transferId": 1,
    "fromUserId": 1,
    "toUserId": 2,
    "amount": 250,
    "status": "completed",
    "note": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô",
    "createdAt": "2025-10-17T14:03:12Z",
    "updatedAt": "2025-10-17T14:03:12Z",
    "completedAt": "2025-10-17T14:03:12Z"
  }
}
```

**Error Response (404 Not Found):**

```json
{
  "error": "NOT_FOUND",
  "message": "Transfer not found"
}
```

#### 3. Get Transfer History (GET /transfers)

‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤/‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô - ‡∏Å‡∏£‡∏≠‡∏á‡∏î‡πâ‡∏ß‡∏¢ userId (‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏±‡πâ‡∏á‡πÇ‡∏≠‡∏ô‡∏≠‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤)

```http
GET /transfers?userId={userId}&page={page}&pageSize={pageSize}
```

**Query Parameters:**

- `userId` (required): ID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
- `page` (optional, default=1): ‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£
- `pageSize` (optional, default=20, max=200): ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤

**Example:**

```bash
curl "http://localhost:3000/transfers?userId=1&page=1&pageSize=20"
```

**Response (200 OK):**

```json
{
  "data": [
    {
      "idemKey": "5d1f8c7a-2b5b-4b1f-9f2a-8f50b0a8d9f3",
      "transferId": 1,
      "fromUserId": 1,
      "toUserId": 2,
      "amount": 250,
      "status": "completed",
      "note": "‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô",
      "createdAt": "2025-10-17T14:03:12Z",
      "updatedAt": "2025-10-17T14:03:12Z",
      "completedAt": "2025-10-17T14:03:12Z"
    },
    {
      "idemKey": "a8b4f2e0-5562-4f1c-9b62-2a2f2f4c9b10",
      "transferId": 2,
      "fromUserId": 3,
      "toUserId": 1,
      "amount": 100,
      "status": "completed",
      "createdAt": "2025-10-17T10:00:00Z",
      "updatedAt": "2025-10-17T10:00:00Z",
      "completedAt": "2025-10-17T10:00:00Z"
    }
  ],
  "page": 1,
  "pageSize": 20,
  "total": 2
}
```

### Transfer Status Values

| Status       | Description    |
| ------------ | -------------- |
| `pending`    | ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£    |
| `processing` | ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ |
| `completed`  | ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à         |
| `failed`     | ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß        |
| `cancelled`  | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å         |
| `reversed`   | ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö       |

### Event Types (Point Ledger)

| Event Type     | Description            |
| -------------- | ---------------------- |
| `transfer_out` | ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡∏≠‡∏≠‡∏Å (‡∏•‡∏ö‡πÅ‡∏ï‡πâ‡∏°)    |
| `transfer_in`  | ‡∏£‡∏±‡∏ö‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏° (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ï‡πâ‡∏°) |
| `adjust`       | ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÅ‡∏ï‡πâ‡∏°           |
| `earn`         | ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πâ‡∏°             |
| `redeem`       | ‡πÅ‡∏•‡∏Å‡πÅ‡∏ï‡πâ‡∏°                |

### Business Rules

1. **‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏≠‡∏ô‡πÅ‡∏ï‡πâ‡∏°‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ**
2. **‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÅ‡∏ï‡πâ‡∏°‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠** (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ï‡πâ‡∏° >= ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô)
3. **‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÉ‡∏ä‡πâ Database Transaction** ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢
4. **‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô Point Ledger** (Audit Trail)
5. **Idempotency Key ‡πÄ‡∏õ‡πá‡∏ô UUID** ‡∏ó‡∏µ‡πà unique ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô

---

## üìÑ License

MIT

## üë®‚Äçüíª Development

‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏î‡∏¢: KBTG Team  
‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: October 17, 2025

---

**Happy Coding! üöÄ**
